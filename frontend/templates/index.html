<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Click, Classify and Clear - HS Code Classification</title>
		<style>
			:root {
				--bg-primary: #0a0f1e;
				--bg-secondary: #111827;
				--bg-card: rgba(255, 255, 255, 0.04);
				--text-primary: #f9fafb;
				--text-secondary: #9ca3af;
				--text-muted: #6b7280;
				--accent-primary: #2563eb;
				--accent-secondary: #1d4ed8;
				--border: rgba(255, 255, 255, 0.08);
				--border-strong: rgba(255, 255, 255, 0.15);
				--shadow: rgba(0, 0, 0, 0.4);
				--shadow-lg: rgba(0, 0, 0, 0.6);
				--success: #059669;
				--success-bg: rgba(5, 150, 105, 0.1);
				--warning: #d97706;
				--warning-bg: rgba(217, 119, 6, 0.1);
				--error: #dc2626;
				--error-bg: rgba(220, 38, 38, 0.1);
				--conf-low: #ef4444;
				--conf-mid: #f59e0b;
				--conf-high: #10b981;
			}

			[data-theme="light"] {
				--bg-primary: #f8fafc;
				--bg-secondary: #ffffff;
				--bg-card: #ffffff;
				--text-primary: #0f172a;
				--text-secondary: #475569;
				--text-muted: #94a3b8;
				--border: rgba(15, 23, 42, 0.1);
				--border-strong: rgba(15, 23, 42, 0.2);
				--shadow: rgba(15, 23, 42, 0.08);
				--shadow-lg: rgba(15, 23, 42, 0.15);
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
					"Helvetica Neue", Arial, sans-serif;
				background: var(--bg-primary);
				color: var(--text-primary);
				min-height: 100vh;
				transition: background 0.3s ease, color 0.3s ease;
				line-height: 1.6;
				-webkit-font-smoothing: antialiased;
			}

			.theme-toggle {
				position: fixed;
				top: 1.5rem;
				right: 1.5rem;
				z-index: 1000;
				background: var(--bg-card);
				border: 1px solid var(--border);
				border-radius: 8px;
				padding: 0.625rem;
				cursor: pointer;
				transition: all 0.2s ease;
				backdrop-filter: blur(10px);
				box-shadow: 0 2px 8px var(--shadow);
			}

			.theme-toggle:hover {
				border-color: var(--border-strong);
				box-shadow: 0 4px 12px var(--shadow);
			}

			.theme-toggle svg {
				width: 24px;
				height: 24px;
				fill: var(--text-primary);
				transition: all 0.3s ease;
			}

			.container {
				max-width: 1280px;
				margin: 0 auto;
				padding: 0;
				min-height: 100vh;
			}

			.header {
				text-align: center;
				padding: 3.5rem 2rem 3rem;
				background: var(--bg-secondary);
				border-bottom: 1px solid var(--border);
				animation: slideDown 0.6s ease-out;
				box-shadow: 0 1px 3px var(--shadow);
			}

			@keyframes slideDown {
				from {
					opacity: 0;
					transform: translateY(-20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.main-content {
				padding: 2.5rem 2rem;
			}

			.header h1 {
				font-size: 2.5rem;
				font-weight: 600;
				margin-bottom: 1rem;
				color: var(--text-primary);
				letter-spacing: -0.02em;
			}

			.header p {
				color: var(--text-secondary);
				font-size: 1.0625rem;
				max-width: 680px;
				margin: 0 auto;
				font-weight: 400;
				line-height: 1.5;
			}

			.content-grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 2rem;
				animation: slideUp 0.8s ease-out 0.2s both;
			}

			@keyframes slideUp {
				from {
					opacity: 0;
					transform: translateY(30px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.upload-section,
			.results-section {
				background: var(--bg-card);
				border: 1px solid var(--border);
				border-radius: 20px;
				padding: 2rem;
				backdrop-filter: blur(20px);
				box-shadow: 0 16px 32px var(--shadow);
			}

			.upload-area {
				border: 2px dashed var(--border);
				border-radius: 16px;
				padding: 3rem 2rem;
				text-align: center;
				cursor: pointer;
				transition: all 0.3s ease;
				background: var(--bg-card);
				margin: 1.5rem 0;
			}

			.upload-area:hover {
				border-color: var(--accent-primary);
				background: rgba(99, 102, 241, 0.05);
				transform: translateY(-2px);
			}

			.or-divider {
				display: flex;
				align-items: center;
				text-align: center;
				margin: 1.5rem 0;
				color: var(--text-muted);
				font-size: 0.9rem;
			}

			.or-divider::before,
			.or-divider::after {
				content: "";
				flex: 1;
				border-bottom: 1px solid var(--border);
			}

			.or-divider::before {
				margin-right: 1rem;
			}

			.or-divider::after {
				margin-left: 1rem;
			}

			.camera-area {
				border: 2px dashed var(--border);
				border-radius: 16px;
				padding: 2rem;
				text-align: center;
				cursor: pointer;
				transition: all 0.3s ease;
				background: var(--bg-card);
				margin: 1.5rem 0;
			}

			.camera-area:hover {
				border-color: #10b981;
				background: rgba(16, 185, 129, 0.05);
				transform: translateY(-2px);
			}

			.camera-icon {
				width: 64px;
				height: 64px;
				margin: 0 auto 1rem;
				background: linear-gradient(135deg, #10b981, #059669);
				border-radius: 16px;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.btn {
				background: var(--accent-primary);
				color: white;
				border: none;
				padding: 0.875rem 2rem;
				border-radius: 8px;
				font-weight: 600;
				font-size: 1rem;
				cursor: pointer;
				transition: all 0.2s ease;
				box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
				width: 100%;
				margin-top: 1.5rem;
			}

			.btn:hover {
				background: var(--accent-secondary);
				transform: translateY(-1px);
				box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
			}

			.btn:disabled {
				background: var(--text-muted);
				cursor: not-allowed;
				transform: none;
				box-shadow: none;
				opacity: 0.6;
			}

			.loading {
				text-align: center;
				padding: 3rem 2rem;
				animation: pulse 2s ease-in-out infinite;
			}

			@keyframes pulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.6;
				}
			}

			.progress-circle {
				position: relative;
				width: 120px;
				height: 120px;
				margin: 0 auto 1.5rem;
			}

			.progress-circle svg {
				transform: rotate(-90deg);
			}

			.progress-circle-bg {
				fill: none;
				stroke: var(--border);
				stroke-width: 8;
			}

			.progress-circle-fill {
				fill: none;
				stroke: var(--accent-primary);
				stroke-width: 8;
				stroke-linecap: round;
				transition: stroke-dashoffset 0.3s ease;
			}

			.progress-text {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				font-size: 1.5rem;
				font-weight: 600;
				color: var(--text-primary);
			}

			.result-item {
				background: var(--bg-card);
				border: 1px solid var(--border);
				border-radius: 12px;
				padding: 1.5rem;
				margin: 1rem 0;
				transition: all 0.3s ease;
				animation: slideInRight 0.5s ease-out;
			}

			@keyframes slideInRight {
				from {
					opacity: 0;
					transform: translateX(20px);
				}
				to {
					opacity: 1;
					transform: translateX(0);
				}
			}

			.result-item:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 32px var(--shadow);
			}

			.result-label {
				font-weight: 700;
				color: var(--accent-primary);
				margin-bottom: 0.5rem;
				font-size: 1rem;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.result-value {
				font-size: 1.1rem;
				line-height: 1.5;
				color: var(--text-primary);
			}

			.hs-code-display {
				font-size: 2rem;
				font-weight: 700;
				color: var(--accent-primary);
				text-align: center;
				padding: 1.5rem;
				background: linear-gradient(
					135deg,
					rgba(37, 99, 235, 0.1),
					rgba(29, 78, 216, 0.05)
				);
				border-radius: 12px;
				margin: 1.5rem 0;
				letter-spacing: 0.05em;
			}

			.confidence-container {
				margin: 1rem 0;
			}

			.confidence-bar {
				width: 100%;
				height: 8px;
				background: var(--border);
				border-radius: 4px;
				margin-top: 0.5rem;
				overflow: hidden;
				position: relative;
			}

			.confidence-fill {
				height: 100%;
				background: linear-gradient(
					90deg,
					var(--conf-low),
					var(--conf-mid) 50%,
					var(--conf-high) 90%
				);
				border-radius: 4px;
				transition: width 0.8s ease;
				position: relative;
			}

			.confidence-label {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 0.5rem;
			}

			.confidence-score {
				font-size: 1.25rem;
				font-weight: 600;
				color: var(--text-primary);
			}

			.alternative-code {
				background: rgba(255, 255, 255, 0.02);
				border: 1px solid var(--border);
				border-radius: 8px;
				padding: 1rem;
				margin: 0.5rem 0;
			}

			.alternative-code-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 0.5rem;
			}

			.alternative-code-number {
				font-weight: 600;
				color: var(--accent-primary);
				font-size: 1.1rem;
			}

			.alternative-confidence {
				font-size: 0.9rem;
				color: var(--text-secondary);
			}

			.collapsible-header {
				background: rgba(255, 255, 255, 0.03);
				border: 1px solid var(--border);
				border-radius: 12px;
				padding: 1rem 1.5rem;
				cursor: pointer;
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin: 1.5rem 0;
				transition: all 0.3s ease;
			}

			.collapsible-header:hover {
				background: rgba(255, 255, 255, 0.05);
				border-color: var(--border-strong);
			}

			.collapsible-header.active {
				border-bottom-left-radius: 0;
				border-bottom-right-radius: 0;
				border-bottom: none;
			}

			.collapsible-content {
				max-height: 0;
				overflow: hidden;
				transition: max-height 0.3s ease;
				border: 1px solid var(--border);
				border-top: none;
				border-radius: 0 0 12px 12px;
			}

			.collapsible-content.active {
				max-height: 5000px;
				padding: 1rem;
			}

			.chevron {
				transition: transform 0.3s ease;
			}

			.chevron.rotated {
				transform: rotate(180deg);
			}

			.invoice-wrapper {
				background: var(--bg-card);
				border: 1px solid var(--border);
				border-radius: 12px;
				padding: 1.5rem;
				margin: 1.5rem 0;
			}

			.invoice-container {
				background: white;
				color: black;
				padding: 2rem;
				border-radius: 8px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			}

			.invoice-header {
				display: flex;
				justify-content: space-between;
				align-items: flex-start;
				margin-bottom: 2rem;
				padding-bottom: 1rem;
				border-bottom: 2px solid #333;
			}

			.invoice-title {
				font-size: 2rem;
				font-weight: 700;
				color: #000;
			}

			.invoice-info {
				text-align: right;
			}

			.invoice-section {
				margin: 1.5rem 0;
				padding: 1rem;
				border: 1px solid #ddd;
			}

			.invoice-section-title {
				font-weight: 700;
				background: #f5f5f5;
				padding: 0.5rem;
				margin: -1rem -1rem 1rem -1rem;
				border-bottom: 1px solid #ddd;
			}

			.invoice-table {
				width: 100%;
				border-collapse: collapse;
				margin: 1rem 0;
			}

			.invoice-table th,
			.invoice-table td {
				border: 1px solid #ddd;
				padding: 0.75rem;
				text-align: left;
			}

			.invoice-table th {
				background: #f5f5f5;
				font-weight: 700;
			}

			.invoice-footer {
				display: flex;
				justify-content: space-between;
				margin-top: 2rem;
				padding-top: 1rem;
				border-top: 2px solid #333;
			}

			.invoice-actions {
				display: flex;
				gap: 1rem;
				margin-bottom: 1rem;
			}

			.invoice-btn {
				background: var(--accent-primary);
				color: white;
				border: none;
				padding: 0.5rem 1rem;
				border-radius: 6px;
				cursor: pointer;
				font-size: 0.9rem;
				transition: all 0.2s ease;
			}

			.invoice-btn:hover {
				background: var(--accent-secondary);
			}

			.characteristic-tag {
				display: inline-block;
				background: rgba(37, 99, 235, 0.1);
				color: var(--accent-primary);
				padding: 0.4rem 0.8rem;
				border-radius: 6px;
				font-size: 0.9rem;
				margin: 0.25rem;
				border: 1px solid rgba(37, 99, 235, 0.3);
			}

			.error {
				background: var(--error-bg);
				border: 1px solid var(--error);
				color: var(--error);
				padding: 1.5rem;
				border-radius: 12px;
				margin: 1rem 0;
			}

			.not-in-doc {
				background: var(--warning-bg);
				border: 2px solid var(--warning);
				color: var(--warning);
				padding: 1.5rem;
				border-radius: 12px;
				margin: 1rem 0;
				text-align: center;
			}

			@media (max-width: 768px) {
				.content-grid {
					grid-template-columns: 1fr;
				}
				.header h1 {
					font-size: 2rem;
				}
			}
		</style>
	</head>
	<body>
		<div class="theme-toggle" onclick="toggleTheme()">
			<svg class="sun-icon" viewBox="0 0 24 24">
				<circle cx="12" cy="12" r="5" />
				<path
					d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
				/>
			</svg>
		</div>

		<div class="container">
			<div class="header">
				<h1>üåê Click, Classify and Clear</h1>
				<p>
					Upload product images for AI-powered HS (Harmonized System) code
					classification with confidence scoring and detailed analysis
				</p>
			</div>

			<div class="main-content">
				<div class="content-grid">
					<div class="upload-section">
						<h3 style="margin-bottom: 1.5rem; color: var(--text-primary)">
							Upload Product Image
						</h3>

						<div
							class="upload-area"
							onclick="document.getElementById('fileInput').click()"
							ondrop="handleDrop(event)"
							ondragover="handleDragOver(event)"
							ondragleave="handleDragLeave(event)"
						>
							<div
								style="
									width: 64px;
									height: 64px;
									margin: 0 auto 1rem;
									background: linear-gradient(
										135deg,
										var(--accent-primary),
										var(--accent-secondary)
									);
									border-radius: 16px;
									display: flex;
									align-items: center;
									justify-content: center;
								"
							>
								<svg
									viewBox="0 0 24 24"
									style="width: 32px; height: 32px; fill: white"
								>
									<path
										d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
									/>
								</svg>
							</div>
							<p
								style="
									font-size: 1.1rem;
									margin-bottom: 0.5rem;
									color: var(--text-primary);
								"
							>
								<span id="uploadText"
									>Drop your image here or click to browse</span
								>
							</p>
							<p style="color: var(--text-secondary); font-size: 0.9rem">
								Supports JPG, PNG, GIF, WebP ‚Ä¢ Max 10MB
							</p>
							<input
								type="file"
								id="fileInput"
								accept="image/*"
								style="display: none"
								onchange="handleFileSelect(event)"
							/>
						</div>

						<div class="or-divider">OR</div>

						<div class="camera-area" onclick="captureWithCamera()">
							<div class="camera-icon">
								<svg
									viewBox="0 0 24 24"
									style="width: 32px; height: 32px; fill: white"
								>
									<path
										d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"
									/>
								</svg>
							</div>
							<p
								style="
									font-size: 1.1rem;
									margin-bottom: 0.5rem;
									color: var(--text-primary);
								"
							>
								Capture with Camera
							</p>
							<p style="color: var(--text-secondary); font-size: 0.9rem">
								Take a photo directly
							</p>
							<p
								style="
									color: var(--text-muted);
									font-size: 0.85rem;
									margin-top: 0.25rem;
								"
							>
								Requires camera permission
							</p>
						</div>

						<div
							id="imagePreview"
							style="display: none; margin-top: 2rem; text-align: center"
						>
							<h4 style="margin-bottom: 1rem; color: var(--text-primary)">
								Selected Image
							</h4>
							<img
								id="previewImg"
								style="
									max-width: 100%;
									max-height: 300px;
									border-radius: 16px;
									box-shadow: 0 16px 32px var(--shadow);
									border: 2px solid var(--border);
								"
								alt="Preview"
							/>
						</div>

						<button
							id="classifyBtn"
							class="btn"
							onclick="classifyImage()"
							disabled
						>
							Classify HS Code
						</button>
					</div>

					<div class="results-section">
						<h3 style="margin-bottom: 1.5rem; color: var(--text-primary)">
							Classification Results
						</h3>

						<div id="loading" style="display: none">
							<div class="loading">
								<div class="progress-circle">
									<svg width="120" height="120">
										<circle
											class="progress-circle-bg"
											cx="60"
											cy="60"
											r="52"
										></circle>
										<circle
											id="progressCircleFill"
											class="progress-circle-fill"
											cx="60"
											cy="60"
											r="52"
											stroke-dasharray="326.73"
											stroke-dashoffset="326.73"
										></circle>
									</svg>
									<div class="progress-text" id="progressText">0%</div>
								</div>
								<p id="loadingStatus" style="color: var(--text-secondary)">
									AI is analyzing your product...
								</p>
								<p
									style="
										color: var(--text-secondary);
										font-size: 0.9rem;
										margin-top: 0.5rem;
									"
								>
									Estimated time: 20-30 seconds
								</p>
							</div>
						</div>

						<div id="results" style="display: none">
							<div id="resultContent"></div>
						</div>

						<div
							id="placeholder"
							style="
								text-align: center;
								padding: 3rem 2rem;
								color: var(--text-secondary);
							"
						>
							<svg
								width="64"
								height="64"
								viewBox="0 0 24 24"
								fill="currentColor"
								style="opacity: 0.3; margin-bottom: 1rem"
							>
								<path
									d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,13H17V11H7"
								/>
							</svg>
							<p>Upload a product image to see HS code classification</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			let selectedFile = null;

			// Theme toggle functionality
			function toggleTheme() {
				const html = document.documentElement;
				const currentTheme = html.getAttribute("data-theme");
				const newTheme = currentTheme === "light" ? "dark" : "light";
				html.setAttribute("data-theme", newTheme);
				localStorage.setItem("theme", newTheme);
			}

			// Load saved theme
			const savedTheme = localStorage.getItem("theme") || "dark";
			document.documentElement.setAttribute("data-theme", savedTheme);

			// Progress management
			let progressInterval = null;
			let currentProgress = 0;

			function startProgress() {
				const totalTime = 30000; // 30 seconds
				const updateInterval = 100;
				const totalUpdates = totalTime / updateInterval;

				currentProgress = 0;
				const circle = document.getElementById("progressCircleFill");
				const text = document.getElementById("progressText");
				const circumference = 326.73;

				if (progressInterval) clearInterval(progressInterval);

				let updateCount = 0;
				progressInterval = setInterval(() => {
					updateCount++;

					const linearProgress = updateCount / totalUpdates;
					const easedProgress = 1 - Math.pow(1 - linearProgress, 3);
					currentProgress = Math.min(Math.floor(easedProgress * 99), 99);

					const offset =
						circumference - (currentProgress / 100) * circumference;
					circle.style.strokeDashoffset = offset;
					text.textContent = currentProgress + "%";

					if (currentProgress >= 99) {
						clearInterval(progressInterval);
					}
				}, updateInterval);
			}

			function completeProgress() {
				const circle = document.getElementById("progressCircleFill");
				const text = document.getElementById("progressText");
				const circumference = 326.73;

				if (progressInterval) clearInterval(progressInterval);

				currentProgress = 100;
				circle.style.strokeDashoffset = 0;
				text.textContent = "100%";

				return new Promise((resolve) => setTimeout(resolve, 300));
			}

			// Drag and drop functionality
			function handleDragOver(event) {
				event.preventDefault();
				event.currentTarget.style.borderColor = "var(--accent-primary)";
			}

			function handleDragLeave(event) {
				event.currentTarget.style.borderColor = "var(--border)";
			}

			function handleDrop(event) {
				event.preventDefault();
				event.currentTarget.style.borderColor = "var(--border)";
				const files = event.dataTransfer.files;
				if (files.length > 0) {
					selectedFile = files[0];
					updateFileSelection();
				}
			}

			function handleFileSelect(event) {
				selectedFile = event.target.files[0];
				updateFileSelection();
			}

			async function captureWithCamera() {
				try {
					const stream = await navigator.mediaDevices.getUserMedia({
						video: { facingMode: "environment" },
					});

					// Create modal for camera preview
					const modal = document.createElement("div");
					modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.95);
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 2rem;
                `;

					const video = document.createElement("video");
					video.srcObject = stream;
					video.autoplay = true;
					video.style.cssText = `
                    max-width: 90%;
                    max-height: 70vh;
                    border-radius: 16px;
                    box-shadow: 0 16px 32px rgba(0, 0, 0, 0.6);
                `;

					const buttonContainer = document.createElement("div");
					buttonContainer.style.cssText = `
                    display: flex;
                    gap: 1rem;
                    margin-top: 2rem;
                `;

					const captureBtn = document.createElement("button");
					captureBtn.textContent = "üì∏ Capture Photo";
					captureBtn.className = "btn";
					captureBtn.style.width = "auto";

					const cancelBtn = document.createElement("button");
					cancelBtn.textContent = "‚úï Cancel";
					cancelBtn.className = "btn";
					cancelBtn.style.width = "auto";
					cancelBtn.style.background = "var(--text-muted)";

					buttonContainer.appendChild(captureBtn);
					buttonContainer.appendChild(cancelBtn);

					modal.appendChild(video);
					modal.appendChild(buttonContainer);
					document.body.appendChild(modal);

					captureBtn.onclick = () => {
						const canvas = document.createElement("canvas");
						canvas.width = video.videoWidth;
						canvas.height = video.videoHeight;
						const ctx = canvas.getContext("2d");
						ctx.drawImage(video, 0, 0);

						canvas.toBlob(
							(blob) => {
								stream.getTracks().forEach((track) => track.stop());
								document.body.removeChild(modal);

								// Show preview modal
								showCapturePreview(blob);
							},
							"image/jpeg",
							0.95
						);
					};

					cancelBtn.onclick = () => {
						stream.getTracks().forEach((track) => track.stop());
						document.body.removeChild(modal);
					};
				} catch (error) {
					alert(
						"Camera access denied or not available. Please check your permissions or try uploading an image instead."
					);
					console.error("Camera error:", error);
				}
			}

			function showCapturePreview(blob) {
				const previewModal = document.createElement("div");
				previewModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                z-index: 10000;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 2rem;
            `;

				const title = document.createElement("h3");
				title.textContent = "Preview Captured Image";
				title.style.cssText = `
                color: white;
                margin-bottom: 1.5rem;
                font-size: 1.5rem;
            `;

				const img = document.createElement("img");
				img.src = URL.createObjectURL(blob);
				img.style.cssText = `
                max-width: 90%;
                max-height: 60vh;
                border-radius: 16px;
                box-shadow: 0 16px 32px rgba(0, 0, 0, 0.6);
                border: 2px solid var(--border);
            `;

				const buttonContainer = document.createElement("div");
				buttonContainer.style.cssText = `
                display: flex;
                gap: 1rem;
                margin-top: 2rem;
            `;

				const submitBtn = document.createElement("button");
				submitBtn.textContent = "‚úì Submit";
				submitBtn.className = "btn";
				submitBtn.style.cssText = `
                width: auto;
                background: var(--success);
            `;

				const retakeBtn = document.createElement("button");
				retakeBtn.textContent = "üîÑ Retake";
				retakeBtn.className = "btn";
				retakeBtn.style.cssText = `
                width: auto;
                background: var(--accent-primary);
            `;

				const cancelBtn = document.createElement("button");
				cancelBtn.textContent = "‚úï Cancel";
				cancelBtn.className = "btn";
				cancelBtn.style.cssText = `
                width: auto;
                background: var(--text-muted);
            `;

				buttonContainer.appendChild(submitBtn);
				buttonContainer.appendChild(retakeBtn);
				buttonContainer.appendChild(cancelBtn);

				previewModal.appendChild(title);
				previewModal.appendChild(img);
				previewModal.appendChild(buttonContainer);
				document.body.appendChild(previewModal);

				submitBtn.onclick = () => {
					selectedFile = new File([blob], "camera-capture.jpg", {
						type: "image/jpeg",
					});
					updateFileSelection();
					URL.revokeObjectURL(img.src);
					document.body.removeChild(previewModal);
				};

				retakeBtn.onclick = () => {
					URL.revokeObjectURL(img.src);
					document.body.removeChild(previewModal);
					captureWithCamera();
				};

				cancelBtn.onclick = () => {
					URL.revokeObjectURL(img.src);
					document.body.removeChild(previewModal);
				};
			}

			function updateFileSelection() {
				if (selectedFile) {
					document.getElementById("classifyBtn").disabled = false;
					document.getElementById(
						"uploadText"
					).textContent = `Selected: ${selectedFile.name}`;
					document.getElementById("placeholder").style.display = "none";

					const reader = new FileReader();
					reader.onload = function (e) {
						document.getElementById("previewImg").src = e.target.result;
						document.getElementById("imagePreview").style.display = "block";
					};
					reader.readAsDataURL(selectedFile);
				}
			}

			function createClassificationCard(classification, index) {
				const card = document.createElement("div");
				card.className = "result-item";

				// Highlight the top classification
				if (index === 0) {
					card.style.borderColor = "var(--accent-primary)";
					card.style.borderWidth = "2px";
					card.style.background = "rgba(37, 99, 235, 0.08)";
				}

				const confidencePercent = Math.round(
					classification.confidence_score * 100
				);

				const hsCodeWithSuffix =
					classification.hs_code +
					(classification.stat_suffix ? "." + classification.stat_suffix : "");
				const customsClearancePercent = (
					Math.random() * (79.9 - 75.0) +
					75.0
				).toFixed(1);

				card.innerHTML = `
                ${
									index === 0
										? '<div style="color: var(--accent-primary); font-weight: 600; margin-bottom: 1rem; font-size: 0.9rem;">‚≠ê TOP MATCH</div>'
										: ""
								}
                
                <div class="hs-code-display" style="margin: 0 0 0.5rem 0; padding: 1rem;">
                    ${hsCodeWithSuffix}
                </div>
                
                <div style="text-align: center; margin-bottom: 1.5rem; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                    <div style="font-size: 1.05rem; color: #10b981; font-weight: 700; margin-bottom: 0.25rem;">
                        ${customsClearancePercent}% of shipments of this or similar product clear customs within 4 days
                    </div>
                    <div style="font-size: 0.75rem; color: #6b7280; font-weight: 400;">
                        Based on the last 2 weeks of trends
                    </div>
                </div>

                <div class="confidence-container" style="margin-bottom: 1rem;">
                    <div class="confidence-label">
                        <span class="result-label">Confidence Score</span>
                        <span class="confidence-score">${confidencePercent}%</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${confidencePercent}%"></div>
                    </div>
                </div>

                ${
									classification.article_description
										? `
                    <div style="margin-bottom: 1rem;">
                        <div class="result-label">HS Code Description</div>
                        <div class="result-value" style="font-size: 0.95rem; font-style: italic;">${classification.article_description}</div>
                    </div>
                `
										: ""
								}

                <div style="margin-bottom: 1rem;">
                    <div class="result-label">Product in Image</div>
                    <div class="result-value">${
											classification.product_description ||
											"Product visible in the uploaded image"
										}</div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <div class="result-label">Classification Reasoning</div>
                    <div class="result-value" style="font-size: 0.95rem;">${
											classification.reasoning
										}</div>
                </div>

                ${
									classification.key_characteristics &&
									classification.key_characteristics.length > 0
										? `
                    <div>
                        <div class="result-label">Key Characteristics</div>
                        <div style="margin-top: 0.5rem;">
                            ${classification.key_characteristics
															.map(
																(char) =>
																	`<span class="characteristic-tag">${char}</span>`
															)
															.join("")}
                        </div>
                    </div>
                `
										: ""
								}
            `;

				return card;
			}

			function toggleCollapsible(id) {
				const content = document.getElementById(id);
				const header = content.previousElementSibling;
				const chevron = document.getElementById("chevron-" + id);

				content.classList.toggle("active");
				header.classList.toggle("active");
				chevron.classList.toggle("rotated");
			}

			function generateInvoice(classification, visualAnalysis) {
				const container = document.createElement("div");
				container.style.cssText = "margin: 2rem 0;";

				const today = new Date();
				const dateStr = today
					.toLocaleDateString("en-GB", {
						day: "2-digit",
						month: "short",
						year: "numeric",
					})
					.toUpperCase();
				const waybillNumber = "HTS" + Date.now().toString().slice(-12);
				const shipmentID =
					"SHP" + Math.random().toString(36).substr(2, 9).toUpperCase();
				const invoiceNumber = "INV-" + Date.now().toString().slice(-8);
				const hsCodeWithSuffix =
					classification.hs_code +
					(classification.stat_suffix ? "." + classification.stat_suffix : "");

				const invoiceHTML = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Invoice - ${invoiceNumber}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; color: #000; }
        .invoice-container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; }
        .invoice-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
        .invoice-title { font-size: 32px; font-weight: bold; }
        .page-number { text-align: right; margin-bottom: 10px; }
        .section { margin: 20px 0; }
        .section-row { display: flex; gap: 20px; }
        .section-col { flex: 1; border: 1px solid #000; padding: 15px; }
        .section-title { font-weight: bold; margin-bottom: 10px; background: #f5f5f5; padding: 5px; margin: -15px -15px 10px -15px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        table th, table td { border: 1px solid #000; padding: 10px; text-align: left; }
        table th { background: #f5f5f5; font-weight: bold; }
        .totals { margin: 20px 0; }
        .totals-row { display: flex; justify-content: flex-end; margin: 5px 0; }
        .totals-label { width: 200px; text-align: right; padding-right: 10px; }
        .totals-value { width: 100px; text-align: right; font-weight: bold; }
        .declaration { border: 1px solid #000; padding: 15px; margin: 20px 0; min-height: 100px; }
        .barcode { font-family: 'Courier New', monospace; font-size: 24px; font-weight: bold; text-align: center; margin: 10px 0; letter-spacing: 2px; }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="page-number">Page 1</div>
        <div class="invoice-header">
            <div class="invoice-title">Invoice</div>
        </div>
        
        <div class="section-row">
            <div class="section-col">
                <div class="section-title">FROM</div>
                <p><strong>Tax ID/EINVAT No.:</strong> IOSS123456789</p>
                <p><strong>Contact Name:</strong> SAMPLE EXPORTER CO.</p>
                <p>123 Export Street<br>Trade City, TC 12345</p>
                <p>United States<br><strong>Phone:</strong> +1 555-0123</p>
            </div>
            <div class="section-col">
                <div style="text-align: right;">
                    <p><strong>Waybill Number:</strong> ${waybillNumber}</p>
                    <p><strong>Shipment ID:</strong> ${shipmentID}</p>
                    <div class="barcode">${shipmentID}</div>
                    <p><strong>Date:</strong> ${dateStr}</p>
                    <p><strong>Invoice No.:</strong> ${invoiceNumber}</p>
                    <p><strong>Purchase No.:</strong> PO-${Math.floor(
											Math.random() * 10000
										)}</p>
                    <p><strong>Terms of Sale (Incoterm):</strong> DAP</p>
                    <p><strong>Reason for Export:</strong> Sample</p>
                </div>
            </div>
        </div>

        <div class="section-row">
            <div class="section-col">
                <div class="section-title">SHIP TO</div>
                <p><strong>Tax ID/VAT No.:</strong> EU987654321</p>
                <p><strong>Contact Name:</strong> SAMPLE IMPORTER</p>
                <p>456 Import Avenue<br>Commerce District<br>Sample City, SC 67890</p>
                <p>Sample Country<br><strong>Phone:</strong> +44 20 1234 5678</p>
            </div>
            <div class="section-col">
                <div class="section-title">SOLD TO INFORMATION</div>
                <p><strong>Tax ID/VAT No.:</strong> EU987654321</p>
                <p><strong>Contact Name:</strong> Same as Ship To</p>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Units</th>
                    <th>U/M</th>
                    <th>Description of Goods/Part No.</th>
                    <th>Harm. Code</th>
                    <th>C/T/O</th>
                    <th>Unit Value</th>
                    <th>Total Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>SET</td>
                    <td>${
											(visualAnalysis && visualAnalysis.product_type) ||
											"Sample Product"
										}<br>REF: ${hsCodeWithSuffix}</td>
                    <td>${hsCodeWithSuffix}</td>
                    <td>US</td>
                    <td>500.00</td>
                    <td>500.00 EUR</td>
                </tr>
            </tbody>
        </table>

        <div class="section-row">
            <div class="section-col" style="flex: 1.5;">
                <div class="section-title">Declaration Statement:</div>
                <p>I hereby certify that the information on this invoice is true and correct and the contents and value of this shipment is as stated above.</p>
                <br><br>
                <p><strong>Shipper: _____________________ Date: _____________________</strong></p>
            </div>
            <div class="section-col">
                <div class="totals">
                    <div class="totals-row">
                        <div class="totals-label">Invoice Line Total:</div>
                        <div class="totals-value">500.00</div>
                    </div>
                    <div class="totals-row">
                        <div class="totals-label">Discount/Rebate:</div>
                        <div class="totals-value">0.00</div>
                    </div>
                    <div class="totals-row">
                        <div class="totals-label">Invoice Sub-Total:</div>
                        <div class="totals-value">500.00</div>
                    </div>
                    <div class="totals-row">
                        <div class="totals-label">Freight:</div>
                        <div class="totals-value">0.00</div>
                    </div>
                    <div class="totals-row">
                        <div class="totals-label">Insurance:</div>
                        <div class="totals-value">0.00</div>
                    </div>
                    <div class="totals-row">
                        <div class="totals-label">Other:</div>
                        <div class="totals-value">0.00</div>
                    </div>
                    <div class="totals-row" style="border-top: 2px solid #000; padding-top: 5px; margin-top: 5px;">
                        <div class="totals-label">Total Invoice Amount:</div>
                        <div class="totals-value">500.00</div>
                    </div>
                    <div class="totals-row">
                        <div class="totals-label">Total Number of Packages: 1</div>
                        <div class="totals-label">Currency: EUR</div>
                    </div>
                    <div class="totals-row">
                        <div class="totals-label">Total Weight: 1.0 KGS</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>`;

				// Store invoice HTML in window for new tab access
				const invoiceId = "invoice-" + Date.now();
				window[invoiceId] = invoiceHTML;

				container.innerHTML = `
                <div class="result-item" style="padding: 1.5rem; text-align: center;">
                    <div class="result-label" style="margin-bottom: 1rem;">üìÑ Invoice Ready</div>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">An invoice has been generated for the top classification result.</p>
                    <button class="invoice-btn" onclick="openInvoiceInNewTab('${invoiceId}')" style="font-size: 1rem; padding: 0.75rem 1.5rem;">
                        üìÑ View Invoice
                    </button>
                </div>
            `;

				return container;
			}

			function openInvoiceInNewTab(invoiceId) {
				const html = window[invoiceId];
				if (html) {
					const newWindow = window.open();
					newWindow.document.write(html);
					newWindow.document.close();
				}
			}

			async function classifyImage() {
				if (!selectedFile) return;

				const formData = new FormData();
				formData.append("file", selectedFile);

				document.getElementById("loading").style.display = "block";
				document.getElementById("results").style.display = "none";
				document.getElementById("placeholder").style.display = "none";
				document.getElementById("classifyBtn").disabled = true;

				startProgress();

				try {
					const response = await fetch("/api/classify-hs-code", {
						method: "POST",
						body: formData,
					});

					const result = await response.json();

					await completeProgress();

					document.getElementById("loading").style.display = "none";
					document.getElementById("classifyBtn").disabled = false;

					if (result.success) {
						displayResults(result.data);
					} else {
						displayError(result.error, result.raw_response);
					}
				} catch (error) {
					await completeProgress();
					document.getElementById("loading").style.display = "none";
					document.getElementById("classifyBtn").disabled = false;
					displayError("Network error: " + error.message);
				}
			}

			function displayResults(data) {
				const resultContent = document.getElementById("resultContent");
				resultContent.innerHTML = "";
				document.getElementById("results").style.display = "block";

				// Check if product not in document
				if (data.not_in_document) {
					const notInDocDiv = document.createElement("div");
					notInDocDiv.className = "not-in-doc";
					notInDocDiv.innerHTML = `
                    <h3 style="margin-bottom: 1rem;">‚ö†Ô∏è Product Not in HS Document</h3>
                    <p style="color: var(--text-primary);">${
											data.reason ||
											"This product does not match any codes in the provided HS code document."
										}</p>
                `;
					resultContent.appendChild(notInDocDiv);

					// Still show visual analysis if available
					if (data.visual_analysis) {
						const visualDiv = document.createElement("div");
						visualDiv.className = "result-item";
						visualDiv.innerHTML = `
                        <div class="result-label">Visual Analysis</div>
                        <div class="result-value">
                            <p><strong>Product Type:</strong> ${
															data.visual_analysis.product_type || "Unknown"
														}</p>
                            <p><strong>Color:</strong> ${
															data.visual_analysis.color || "Unknown"
														}</p>
                            <p><strong>Processing State:</strong> ${
															data.visual_analysis.processing_state || "Unknown"
														}</p>
                            ${
															data.visual_analysis.packaging
																? `<p><strong>Packaging:</strong> ${data.visual_analysis.packaging}</p>`
																: ""
														}
                            ${
															data.visual_analysis.special_markers
																? `<p><strong>Special Markers:</strong> ${data.visual_analysis.special_markers}</p>`
																: ""
														}
                        </div>
                    `;
						resultContent.appendChild(visualDiv);
					}
					return;
				}

				// Create collapsible section for analysis details
				const hasExtraction = data.label_text_extraction;
				const hasAnalysis = data.visual_analysis;

				if (hasExtraction || hasAnalysis) {
					const detailsId = "analysis-details-" + Date.now();

					// Create collapsible header
					const collapsibleHeader = document.createElement("div");
					collapsibleHeader.className = "collapsible-header";
					collapsibleHeader.onclick = () => toggleCollapsible(detailsId);
					collapsibleHeader.style.marginTop = "0";
					collapsibleHeader.innerHTML = `
                    <span style="font-size: 0.9rem; color: var(--text-secondary);">üîç Analysis Details (Text Extraction & Visual Analysis)</span>
                    <svg class="chevron" id="chevron-${detailsId}" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                `;
					resultContent.appendChild(collapsibleHeader);

					// Create collapsible content
					const collapsibleContent = document.createElement("div");
					collapsibleContent.className = "collapsible-content";
					collapsibleContent.id = detailsId;

					// Label Text Extraction
					if (hasExtraction) {
						const extractionDiv = document.createElement("div");
						extractionDiv.className = "result-item";
						extractionDiv.style.marginBottom = "1rem";

						const hasQualifiers =
							data.label_text_extraction.qualifier_keywords &&
							data.label_text_extraction.qualifier_keywords.length > 0;
						const hasCertifications =
							data.label_text_extraction.certification_marks &&
							data.label_text_extraction.certification_marks.length > 0;

						extractionDiv.innerHTML = `
                        <div class="result-label" style="font-size: 0.85rem; opacity: 0.8;">üìã Label Text Extraction</div>
                        <div class="result-value" style="font-size: 0.9rem;">
                            ${
															data.label_text_extraction.visible_text &&
															data.label_text_extraction.visible_text.length > 0
																? `
                                <div style="margin-bottom: 1rem;">
                                    <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.5rem;">Visible Text:</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.4rem;">
                                        ${data.label_text_extraction.visible_text
																					.map(
																						(text) =>
																							`<span class="characteristic-tag" style="font-size: 0.85rem;">${text}</span>`
																					)
																					.join("")}
                                    </div>
                                </div>
                            `
																: ""
														}
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 0.75rem;">
                                <div>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.25rem;">Certification Marks</div>
                                    <div style="color: ${
																			hasCertifications
																				? "var(--success)"
																				: "var(--text-muted)"
																		}; font-weight: 500;">
                                        ${
																					hasCertifications
																						? data.label_text_extraction.certification_marks.join(
																								", "
																						  )
																						: "None"
																				}
                                    </div>
                                </div>
                                
                                <div>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.25rem;">Qualifier Keywords</div>
                                    <div style="color: ${
																			hasQualifiers
																				? "var(--success)"
																				: "var(--text-muted)"
																		}; font-weight: 500;">
                                        ${
																					hasQualifiers
																						? data.label_text_extraction.qualifier_keywords.join(
																								", "
																						  )
																						: "None"
																				}
                                    </div>
                                </div>
                            </div>
                            
                            ${
															!hasQualifiers && !hasCertifications
																? `
                                <div style="background: rgba(251, 191, 36, 0.1); border-left: 3px solid #f59e0b; padding: 0.75rem; margin-top: 1rem; border-radius: 4px;">
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                        No specific qualifiers found ‚Üí Using general "Other" classification
                                    </div>
                                </div>
                            `
																: ""
														}
                        </div>
                    `;
						collapsibleContent.appendChild(extractionDiv);
					}

					// Visual Analysis
					if (hasAnalysis) {
						const visualDiv = document.createElement("div");
						visualDiv.className = "result-item";
						visualDiv.innerHTML = `
                        <div class="result-label" style="font-size: 0.85rem; opacity: 0.8;">üîç Visual Analysis</div>
                        <div class="result-value" style="font-size: 0.9rem;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong style="color: var(--text-primary);">${
																	data.visual_analysis.product_type ||
																	"Unknown Product"
																}</strong>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; line-height: 1.6;">
                                ${
																	data.visual_analysis.color
																		? `Color: ${data.visual_analysis.color}`
																		: ""
																} 
                                ${
																	data.visual_analysis.processing_state
																		? `‚Ä¢ State: ${data.visual_analysis.processing_state}`
																		: ""
																}
                                ${
																	data.visual_analysis.packaging
																		? `<br>Packaging: ${data.visual_analysis.packaging}`
																		: ""
																}
                                ${
																	data.visual_analysis.decorative_elements
																		? `<br>Decorative: ${data.visual_analysis.decorative_elements}`
																		: ""
																}
                            </div>
                        </div>
                    `;
						collapsibleContent.appendChild(visualDiv);
					}

					resultContent.appendChild(collapsibleContent);
				}

				// Display classifications as cards
				if (data.classifications && data.classifications.length > 0) {
					const classificationsHeader = document.createElement("div");
					classificationsHeader.style.cssText =
						"margin: 1.5rem 0 1rem 0; color: var(--text-secondary); font-size: 0.95rem;";
					classificationsHeader.textContent = `Found ${
						data.classifications.length
					} possible classification${
						data.classifications.length > 1 ? "s" : ""
					} (ordered by confidence):`;
					resultContent.appendChild(classificationsHeader);

					// Display TOP MATCH first
					const topMatch = data.classifications[0];
					const topCard = createClassificationCard(topMatch, 0);
					resultContent.appendChild(topCard);

					// Collapsible section for alternative results
					if (data.classifications.length > 1) {
						const collapsibleId = "alternatives-" + Date.now();

						const collapsibleHeader = document.createElement("div");
						collapsibleHeader.className = "collapsible-header";
						collapsibleHeader.onclick = () => toggleCollapsible(collapsibleId);
						collapsibleHeader.innerHTML = `
                        <span style="font-weight: 600;">üìã Alternative Classifications (${
													data.classifications.length - 1
												})</span>
                        <svg class="chevron" id="chevron-${collapsibleId}" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    `;
						resultContent.appendChild(collapsibleHeader);

						const collapsibleContent = document.createElement("div");
						collapsibleContent.className = "collapsible-content";
						collapsibleContent.id = collapsibleId;

						// Add alternative classifications
						for (let i = 1; i < data.classifications.length; i++) {
							const altCard = createClassificationCard(
								data.classifications[i],
								i
							);
							collapsibleContent.appendChild(altCard);
						}

						resultContent.appendChild(collapsibleContent);
					}

					// Generate Invoice ONCE for top match only
					const invoiceContainer = generateInvoice(
						topMatch,
						data.visual_analysis
					);
					resultContent.appendChild(invoiceContainer);
				} else {
					// Fallback for old format (single classification)
					const hsCodeDiv = document.createElement("div");
					hsCodeDiv.className = "hs-code-display";
					hsCodeDiv.textContent = data.hs_code || "No classification found";
					resultContent.appendChild(hsCodeDiv);

					if (data.confidence_score !== undefined) {
						const confidenceDiv = document.createElement("div");
						confidenceDiv.className = "confidence-container result-item";
						const confidencePercent = Math.round(data.confidence_score * 100);
						confidenceDiv.innerHTML = `
                        <div class="confidence-label">
                            <span class="result-label">Confidence Score</span>
                            <span class="confidence-score">${confidencePercent}%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidencePercent}%"></div>
                        </div>
                    `;
						resultContent.appendChild(confidenceDiv);
					}

					if (data.product_description) {
						const descDiv = document.createElement("div");
						descDiv.className = "result-item";
						descDiv.innerHTML = `
                        <div class="result-label">Product Description</div>
                        <div class="result-value">${data.product_description}</div>
                    `;
						resultContent.appendChild(descDiv);
					}

					if (data.reasoning) {
						const reasonDiv = document.createElement("div");
						reasonDiv.className = "result-item";
						reasonDiv.innerHTML = `
                        <div class="result-label">Classification Reasoning</div>
                        <div class="result-value">${data.reasoning}</div>
                    `;
						resultContent.appendChild(reasonDiv);
					}

					if (data.key_characteristics && data.key_characteristics.length > 0) {
						const charDiv = document.createElement("div");
						charDiv.className = "result-item";
						charDiv.innerHTML = `
                        <div class="result-label">Key Characteristics</div>
                        <div style="margin-top: 0.75rem;">
                            ${data.key_characteristics
															.map(
																(char) =>
																	`<span class="characteristic-tag">${char}</span>`
															)
															.join("")}
                        </div>
                    `;
						resultContent.appendChild(charDiv);
					}
				}
			}

			function displayError(error, rawResponse) {
				const resultContent = document.getElementById("resultContent");
				resultContent.innerHTML = "";
				document.getElementById("results").style.display = "block";

				const errorDiv = document.createElement("div");
				errorDiv.className = "error";
				errorDiv.innerHTML = `
                <h4 style="margin-bottom: 1rem;">‚ùå Classification Error</h4>
                <p style="margin-bottom: 0.5rem;">${error}</p>
                ${
									rawResponse
										? `<details style="margin-top: 1rem;"><summary style="cursor: pointer;">View raw response</summary><pre style="margin-top: 0.5rem; font-size: 0.85rem; overflow: auto;">${rawResponse}</pre></details>`
										: ""
								}
            `;
				resultContent.appendChild(errorDiv);
			}
		</script>
	</body>
</html>
